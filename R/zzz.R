.onLoad <- function(libname, pkgname) {
  bioc_required <- c(
    "DESeq2", "org.Hs.eg.db", "org.Mm.eg.db", "clusterProfiler", 
    "enrichplot", "Biobase", 
    "ComplexHeatmap", "msigdbr", "ReactomePA" 
  )

  cran_required <- c("ggplot2", "reshape2", "dplyr", "tibble", "stringr", 
                     "readr", "DT", "RColorBrewer", "shiny", "shinythemes")

  install_if_missing <- function(pkgs, installer) {
    for (pkg in pkgs) {
      if (!requireNamespace(pkg, quietly = TRUE)) {
        installer(pkg)
      }
    }
  }
utils::globalVariables(c("Gene_Symbol", "TF_name", "V1", "V2", "br"))

  # Install CRAN packages if needed
  install_if_missing(cran_required, install.packages)

  # Install Bioconductor packages if needed
  if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
  install_if_missing(bioc_required, BiocManager::install)
  if (is.null(getOption("TranscriptoPathR.bs"))) {
    options(TranscriptoPathR.bs = tpr_theme())
  }
}

